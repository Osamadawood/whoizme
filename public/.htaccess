DirectoryIndex index.php
RewriteEngine On
RewriteBase /

# 1) Redirect visible *.php → extension-less (must come before -f rule)
RewriteCond %{THE_REQUEST} \s/+(.+?)\.php[\s?] [NC]
RewriteRule ^ %1 [R=301,L]

# 2) Serve existing files/folders as-is
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 3) Pretty routes → map to PHP entry points
RewriteRule ^dashboard/?$         dashboard.php         [L,QSA]
RewriteRule ^login/?$             login.php             [L,QSA]
RewriteRule ^logout/?$            logout.php            [L,QSA]
RewriteRule ^register/?$          register.php          [L,QSA]
RewriteRule ^settings/?$          profile_edit.php      [L,QSA]
RewriteRule ^search/?$            search.php            [L,QSA]
RewriteRule ^qr-codes/?$          qr/index.php          [L,QSA]
RewriteRule ^api/qr/save/?$       api/qr/save.php       [L,QSA]
RewriteRule ^dev/run_migration/?$ dev/run_migration.php [L,QSA]
RewriteRule ^r/([A-Za-z0-9_-]+)/?$ r/index.php?c=$1     [L,QSA]
RewriteRule ^u/([A-Za-z0-9_-]+)/?$ u.php?u=$1           [L,QSA]

# 4) Generic fallback: /foo -> foo.php (internal mapping only)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{DOCUMENT_ROOT}/$1.php -f
RewriteRule ^(.+?)/?$ $1.php [L,QSA]

# 5) Normalize trailing slash
RewriteCond %{REQUEST_URI} .+/$
RewriteRule ^(.+)/$ /$1 [R=301,L]